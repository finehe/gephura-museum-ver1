import{o as e,c as s,w as o,r as t,n as a,i,a as n,b as l,s as c,d,e as u,f as r,g as p,h as f,t as g,j as h,k as _,l as m,I as k}from"./index-B3zB-9EW.js";import{_ as I,S as v,i as C,u as b,s as y,a as T}from"./SidebarNav.DHBU1t21.js";const M={name:"IosCard",props:{elevated:{type:Boolean,default:!0}}};const V=I({components:{SidebarNav:v,IosCard:I(M,[["render",function(n,l,c,d,u,r){const p=i;return e(),s(p,{class:a(["ios-card",{elevated:c.elevated}])},{default:o((()=>[t(n.$slots,"default",{},void 0,!0)])),_:3},8,["class"])}],["__scopeId","data-v-9bf3b394"]])},data:()=>({city:"定位中...",uid:0,uuid:"",userInput:"",isVoiceMode:!1}),mounted(){this.getLocation(),C((e=>{this.uid=e.uid,this.uuid=e.uuid,console.log("User Info:",e)}))},methods:{getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{this.reverseGeocoding(e.coords.latitude,e.coords.longitude)}),(e=>{console.error("H5定位错误:",e),this.city="无法获取定位"})):(console.error("浏览器不支持定位"),this.city="无法获取定位")},checkWxLocationAuth(){},reverseGeocoding(e,s){n({url:`https://restapi.amap.com/v3/geocode/regeo?key=aa167e521fc7617f0c0aba2a75fdba72&location=${s},${e}`,success:e=>{"1"===e.data.status&&e.data.regeocode&&(this.city=e.data.regeocode.addressComponent.city||e.data.regeocode.addressComponent.province)},fail:()=>{this.city="无法获取城市信息"}})},takePhoto(){l({count:1,sourceType:["camera","album"],success:e=>{const s=e.tempFilePaths[0];b(s,this.uid,this.uuid,this.openTalkPage)}})},scanCode(){c({success:e=>{y(e.result,this.uid,this.uuid,this.openTalkPage)}})},openTalkPage(e){if(e)try{const s=JSON.parse(e).chatGroupId;d(`conversation_${s}`,e),u({url:`/pages/talk/talk?chatGroupId=${s}`})}catch(s){console.error("Failed to parse data:",s)}else console.error("Data is null or undefined")},toggleSidebar(){this.$refs.sidebarNav.toggleSidebar()},toggleInputMode(){this.isVoiceMode=!this.isVoiceMode},handleTextInput(){this.userInput.trim()&&this.sendTextMessage()},sendTextMessage(){console.log("Sending message:",this.userInput),T(this.uid,this.uuid,this.userInput).then((e=>{200===e.code?(console.log("Conversation started:",e),this.openTalkPage(JSON.stringify(e.data))):console.error("Failed to start conversation:",e.data)})).catch((e=>{console.error("Error starting conversation:",e)})),this.userInput=""},startVoiceInput(){console.log("开始录音...")},endVoiceInput(){console.log("结束录音...")},openMediaOptions(){console.log("打开多媒体选项...")}}},[["render",function(t,a,n,l,c,d){const u=_,I=m,v=i,C=r("ios-card"),b=r("SidebarNav"),y=k;return e(),s(v,{class:"ios-home-container"},{default:o((()=>[p(v,{class:"ios-header"},{default:o((()=>[p(u,{src:"/assets/logo-B5n3nu2_.png",class:"ios-logo",mode:"aspectFit"}),p(v,{class:"ios-location"},{default:o((()=>[p(I,{class:"ios-location-icon"},{default:o((()=>[f("📍")])),_:1}),p(I,{class:"ios-location-text"},{default:o((()=>[f(g(c.city),1)])),_:1})])),_:1}),p(v,{class:"ios-header-button",onClick:d.toggleSidebar},{default:o((()=>[p(I,{class:"ios-header-button-icon"},{default:o((()=>[f("☰")])),_:1})])),_:1},8,["onClick"])])),_:1}),p(C,{class:"ios-welcome-card"},{default:o((()=>[p(v,{class:"ios-welcome-content"},{default:o((()=>[p(u,{src:"/assets/large-logo-rkTKCi0J.png",class:"ios-avatar",mode:"aspectFit"}),p(I,{class:"ios-welcome-title"},{default:o((()=>[f("Hi，我是你的导游助手")])),_:1}),p(I,{class:"ios-welcome-description"},{default:o((()=>[f(" 我精通博物馆、植物馆、动物园、天体、物理、文化、体育、古今中外... ")])),_:1})])),_:1})])),_:1}),p(v,{class:"ios-features-grid"},{default:o((()=>[p(C,{class:"ios-feature-card",onClick:d.takePhoto},{default:o((()=>[p(v,{class:"ios-feature-content"},{default:o((()=>[p(u,{src:"/assets/photo-icon-Z91H8Pd_.png",class:"ios-feature-icon",mode:"aspectFit"}),p(I,{class:"ios-feature-title"},{default:o((()=>[f("拍一下")])),_:1}),p(I,{class:"ios-feature-description"},{default:o((()=>[f("拍照识别展品")])),_:1})])),_:1})])),_:1},8,["onClick"]),p(C,{class:"ios-feature-card",onClick:d.scanCode},{default:o((()=>[p(v,{class:"ios-feature-content"},{default:o((()=>[p(u,{src:"/assets/scan-icon-9n4B3E1S.png",class:"ios-feature-icon",mode:"aspectFit"}),p(I,{class:"ios-feature-title"},{default:o((()=>[f("扫一扫")])),_:1}),p(I,{class:"ios-feature-description"},{default:o((()=>[f("扫码了解详情")])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1}),p(b,{ref:"sidebarNav"},null,512),p(v,{class:"ios-input-footer"},{default:o((()=>[p(v,{class:"ios-input-mode-button",onClick:d.toggleInputMode},{default:o((()=>[p(I,null,{default:o((()=>[f(g(c.isVoiceMode?"键盘":"语音"),1)])),_:1})])),_:1},8,["onClick"]),p(v,{class:"ios-input-field"},{default:o((()=>[c.isVoiceMode?(e(),s(v,{key:1,class:"ios-voice-button",onTouchstart:d.startVoiceInput,onTouchend:d.endVoiceInput},{default:o((()=>[p(I,null,{default:o((()=>[f("按住说话")])),_:1})])),_:1},8,["onTouchstart","onTouchend"])):(e(),s(y,{key:0,type:"text",modelValue:c.userInput,"onUpdate:modelValue":a[0]||(a[0]=e=>c.userInput=e),placeholder:"有什么想问的...",onKeyup:h(d.handleTextInput,["enter"]),class:"ios-text-input"},null,8,["modelValue","onKeyup"]))])),_:1}),p(v,{class:"ios-input-action"},{default:o((()=>[c.userInput.trim()?(e(),s(v,{key:0,class:"ios-send-button",onClick:d.sendTextMessage},{default:o((()=>[p(I,null,{default:o((()=>[f("发送")])),_:1})])),_:1},8,["onClick"])):(e(),s(v,{key:1,class:"ios-more-button",onClick:d.openMediaOptions},{default:o((()=>[p(I,null,{default:o((()=>[f("+")])),_:1})])),_:1},8,["onClick"]))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-d6fe2364"]]);export{V as default};
